---
author: Procube Co.,Ltd.
---

# パスワード変更サーブレット

パスワード変更サーブレットは、エンドユーザにパスワード変更のための画面を提供します。

## ユースケース

パスワード変更サーブレットは以下のユースケースを想定しています。

|ユースケース|説明|
|------|---|
|自主的変更|エンドユーザが自主的ににパスワードを変更する場合|
|強要変更|運用上の理由でエンドユーザが使用しているパスワードの変更が求められて、変更する場合で、以下のようなケースがある。 -   パスワードの有効期限を定めて運用している場合で、有効期限切れが間近である場合。運用上、初期パスワードの安全性が低く仮のパスワードである場合で、初回ログイン時にパスワード変更が求められる場合|
|パスワード忘れ|エンドユーザがパスワードを忘れた場合|

## 認証連携

パスワード変更サーブレットは、独立して機能を提供することもできますが、 呼び出し元のシステムでユーザがログイン済みである場合に、そのログイン済み情報を引き継いで動作することもできます。 前者を「独立モード」、後者を「連携モード」と呼びます。

## 呼び出し

パスワード変更サーブレットの呼び出しURLは "/changePassword/changePassword" です。 パスワード変更サーブレットを呼び出す場合には、HTTP GET メソッドのURLのクエリ文字列か HTTP POST メソッドのフォームデータでパラメータを指定します。 HTTP GET メソッドで呼び出した場合、パラメータを隠すために POST メソッドに変換するページが返されます。

|パラメータ名 / 項目名|説明|データ型|制限など|
|------------|---|----|----|
|uid / ユーザID|パスワードを変更するユーザのユーザID|string|連携モードのときは必須。独立モードのときは要求時のみフラグが true のとき必須。存在するユーザのユーザID でなければならない|
|returnURL / 戻り先URL|パスワード変更が終了時あるいはパスワードの変更の必要がなかった場合の戻り先URL|string|必須|
|requiredOnly / 要求時のみフラグ|エンドユーザにパスワード変更が要求されている場合のみ、パスワード変更画面を表示する|boolean|連携モードのときは必須|
|noPassword / パスワード非要求フラグ|連携モードでこのフラグに true を指定された場合は、現在のパスワードをエンドユーザに要求しない|boolean|連携モードの時は必須。独立モードのときは true は指定できない|
|questionField / 秘密の質問設定表示|システム設定オブジェクトの PW秘密質問利用が true の場合に、この項目の値によって秘密の質問と答えの設定フィールドの表示を制御する|**display**|現在の値を設定した状態で秘密の質問と答えを表示する（ただし、連携モードのときのみ）|
|**noValue**|空欄の状態で秘密の質問と答えを表示する（独立モードでも利用可能）|
|**no**|秘密の質問と答えを表示しない（デフォルト）||string|連携モードの時は必須。\[display, noValue, no\] のいずれか|
|requiredQuestion / 秘密の質問必須フラグ|システム設定オブジェクトの PW秘密質問利用が true、秘密の質問設定表示が noValue の場合に、この項目の値に true が指定されると秘密の質問と答えを必須項目とし、ユーザに必ず入力させるようにする|boolean|連携モードのときは必須。秘密の質問設定表示が display のときは false は指定できない。秘密の質問設定表示が no のときは場合は true は指定できない（ただし、 false の場合でも意味をもたない）|
|systemId / システムID|パスワード変更サーブレットを呼び出したシステムの ID で、このパラメータが指定された場合は、連携モードになる|string|連携モードの時は必須。独立モードのときは指定できない。登録されているシステムの ID でなければならない。|
|timestamp / 呼び出し時刻|パスワード変更サーブレットを呼び出した時刻。「yyyy-MM-ddTHH:mm:ssZ」形式で指定する|date|連携モードの時は必須。独立モードのときは指定できない。受信時の時刻と前後５分以上の開きがある場合は、不正な呼び出しとしてエラーとなる|
|signature / 署名|呼び出し側システムごとに与えられている API鍵をパラメータ名 "key" として signature 以外のパラメータに追加した json データを、ソルト付き SHA1アルゴリズムでハッシュしたものを base64 エンコーディングしたもの。 json データは、パラメータ名の昇順で作成し、作成するパラメータに過不足があってはならない。また、boolean形式の値も文字列として扱い、インデント等の整形はしない。 json データの例は表外ヒントを参照|string|連携モードの時は必須。独立モードのときは指定できない|

**Tip:** \{"key":"key001","noPassword":"false","questionField":"noValue","requiredOnly":"false","requiredQuestion":"true","returnURL":"https://localhost/sample/index.html","systemId":"id001","timestamp":"2013-11-12T03:01:12Z","uid":"user001"\}

## インタフェースへのアクセス

パスワード変更サーブレットを利用する場合、 IDM2 のデータベースで連携システムインタフェースとパスワード変更インタフェースの二つのインタフェースを設定しておく必要があります。 パスワード変更サーブレットは、これらのインタフェースにアクセスしながら動作します。 パスワード変更サーブレットはシステム管理者としてアクセスするため、アクセス制御リストは空でもかまいません。

## 連携システムインタフェース

パスワード変更サーブレットの連携モードでは、 呼び出しパラメータの systemId の値をキーにして連携システムインタフェースに問い合わせて、 連携システムオブジェクトを取得し、連携システムの署名を確認します。 独立モードしか使用しない場合は、連携システムインタフェースを設定する必要はありません。 パスワード変更サーブレットは、 連携システムインタフェースのインタフェース名をシステム設定オブジェクトの連携システムリストから取得してアクセスします。

連携システムオブジェクトは以下の属性を持たなければなりません。

|名前 / 表示名|説明|データ型|修飾子|
|--------|---|----|---|
|systemId / システムID|連携するシステムのID。パスワード変更サーブレットの呼び出しパラメータの systemId と一致するものが使用される。|string|必須。一意。連携システムオブジェクトのキー属性|
|key / 鍵|連携システムと共有している秘密のパスワード|string||

## パスワード変更インタフェース

パスワード変更サーブレットは、ユーザID の値をキーにしてパスワード変更インタフェースに問い合わせて、 ユーザオブジェクトを取得し、パスワードを変更後、同じインタフェースでユーザオブジェクトを更新します。 パスワード変更サーブレットは、 パスワード変更インタフェースのインタフェース名をシステム設定オブジェクトの PW変更インタフェースから取得してアクセスします。

パスワード変更インタフェースの作成の際は、以下の点に注意してください。

-   ユーザID がユーザオブジェクトのキー属性 \(keyProperty\) でないときは、パスワード変更インタフェースの属性 \(properties\) にキーとなる属性の名前も指定する必要がある。その属性の名前または属性名マッピングの先属性は「keyProperty」でなければならない。
-   パスワードが AES 暗号化されているときは、パスワード変更インタフェースの「AES復号化レスポンス使用フラグ」を使う。

ユーザオブジェクトは以下の属性を持たなければなりません。

|名前 / 表示名|説明|データ型|修飾子|
|--------|---|----|---|
|uid / ユーザID|ユーザを識別する ID。|string|必須。一意。属性の名前は uid （属性名マッピングは使用できない）|
|password / パスワード|ユーザのパスワード。|string||
|toBeChanged / 変更要求フラグ|パスワードが変更されるべき状態であることを示すフラグ。|boolean||
|expireDate / 有効期限|パスワードの有効期限|date||
|question / 秘密の質問|パスワードを忘れたときにエンドユーザに聞く質問。システム設定オブジェクトの PW秘密質問利用が false の場合はこの属性はなくてもよい|string||
|answer / 答え|パスワードを忘れたときにエンドユーザに聞く質問の答え。システム設定オブジェクトの PW秘密質問利用が false の場合はこの属性はなくてもよい|string||
|mail / メールアドレス|ユーザのメールアドレス。パスワード忘れ受付サーブレットで発信されるメールTo として利用する。[パスワード忘れ受付サーブレット](initializePassword)を使用しない場合はこの属性はなくてもよい|string||
|param1 / パラメータ１|ユーザオブジェクトの任意の属性。パスワード忘れ受付サーブレットで発信されるメール本文の埋め込み文字として利用する。 [パスワード忘れ受付サーブレット](initializePassword)を使用しない場合やメール本文に埋め込み文字が必要ない場合はこの属性はなくてもよい|string||
|param2 / パラメータ２|ユーザオブジェクトの任意の属性。パスワード忘れ受付サーブレットで発信されるメール本文の埋め込み文字として利用する。 [パスワード忘れ受付サーブレット](initializePassword)を使用しない場合やメール本文に埋め込み文字が必要ない場合はこの属性はなくてもよい|string||
|param3 / パラメータ３|ユーザオブジェクトの任意の属性。パスワード忘れ受付サーブレットで発信されるメール本文の埋め込み文字として利用する。 [パスワード忘れ受付サーブレット](initializePassword)を使用しない場合やメール本文に埋め込み文字が必要ない場合はこの属性はなくてもよい|string||
|param4 / パラメータ４|ユーザオブジェクトの任意の属性。パスワード忘れ受付サーブレットで発信されるメール本文の埋め込み文字として利用する。 [パスワード忘れ受付サーブレット](initializePassword)を使用しない場合やメール本文に埋め込み文字が必要ない場合はこの属性はなくてもよい|string||

## 画面の構成要素

パスワード変更サーブレットは以下の要素が表示されます

|項目|説明|表示条件等|
|---|---|-----|
|システム名|システム設定オブジェクトのシステム名の値が表示される。| |
|ロゴ|システム設定オブジェクトでロゴファイルに指定した画像が表示される| |
|メッセージ|パスワード変更のメッセージが表示される。メッセージは３種類で、それぞれの状況は次のとおり。|**パスワードを変更してください。**|デフォルト|
|**現在のパスワードは初期パスワードです。パスワードを変更してください。**|ユーザオブジェクトの変更要求フラグが true のとき|
|**現在のパスワードの有効期限があと n 日で切れます。パスワードを変更してください。**|ユーザオブジェクトの有効期限の残り日数が、システム設定オブジェクトのPW変更促進メッセージ表示開始日で指定した日数以下になったとき|
|**パスワードの有効期限が切れています。パスワードを変更してください。**|ユーザオブジェクトの有効期限が切れているとき||状況に対応したメッセージが表示される|
|ユーザID|パスワードの設定対象となるユーザID を入力するフィールド。 パスワード変更インタフェース呼び出し時にこの値を引数として呼び出す。|サーブレット呼び出し時の URL で uidクエリ文字列が指定されている場合は、その値が設定され、編集不能となる。 また、連携モードでは、必ず、 uidクエリ文字列が指定されていなければならない。|
|エラーメッセージ|パスワードの設定でエラーが発生した場合に、エラーメッセージを表示する。|エラーが発生したときのみ表示される|
|現在のパスワード|ユーザの本人確認を行うために、ユーザがパスワードを入力するフィールド|独立モードのときは、必須|
|新しいパスワード|ユーザが新しく設定するパスワードの入力フィールド|必須|
|新しいパスワード（確認用）|ユーザが新しく設定するパスワードの確認用の入力フィールド|必須|
|パスワードポリシー|ユーザが新しく設定するパスワードに関するポリシーを示す注意書き|必須|
|秘密の質問|ユーザが新しく設定する秘密の質問の内容。この属性のユーザオブジェクトへの更新は、呼び出しパラメータの秘密の質問設定表示の値によって異なる。-   display の場合、常に更新する（入力値が空白の場合はエラー）。noValue の場合、秘密の質問と答えの両方の値が設定されたときのみ更新する。それ以外のときは更新しない（ユーザオブジェクトの値、入力値ともに空白の場合はエラー。ただし、呼び出しパラメータの秘密の質問必須フラグが true のときは、入力値が空白の場合はエラー）。no の場合、常に更新しない|システム設定オブジェクトの PW秘密質問利用が true の場合で、呼び出しパラメータの秘密の質問設定表示が display または noValue のときのみ表示する。 また、呼び出しパラメータの秘密の質問設定表示に display が指定されている場合は、ユーザオブジェクトの question の値が初期値として設定される。|
|答え|ユーザが新しく設定する秘密の質問に対する答え。この属性のユーザオブジェクトへの更新は、呼び出しパラメータの秘密の質問設定表示の値によって異なる。-   display の場合、常に更新する（入力値が空白の場合はエラー）。noValue の場合、秘密の質問と答えの両方の値が設定されたときのみ更新する。それ以外のときは更新しない（ユーザオブジェクトの値、入力値ともに空白の場合はエラー。ただし、呼び出しパラメータの秘密の質問必須フラグが true のときは、入力値が空白の場合はエラー）。no の場合、常に更新しない|システム設定オブジェクトの PW秘密質問利用が true の場合で、呼び出しパラメータの秘密の質問設定表示が display または noValue のときのみ表示する。 また、呼び出しパラメータの秘密の質問設定表示に display が指定されている場合は、ユーザオブジェクトの answer の値が初期値として設定される。|
|秘密の質問の説明文|ユーザが設定する秘密の質問、答えの注意書き|システム設定オブジェクトの PW秘密質問利用が false、または、呼び出しパラメータの秘密の質問設定表示に none が指定されている場合は、表示されない。|
|OKボタン|パスワード、秘密の質問、答えを設定するボタン。更新に成功すると戻り先URL にリダイレクトする。|必須|
|キャンセルボタン|パスワード、秘密の質問、答えを設定せずに戻り先URL にリダイレクトする。|呼び出しパラメータの要求時のみフラグが指定されている場合は、表示されない。|
|実行種別|フォームを POST するときの実行種別を設定する。 OKボタンを押したときは "ok"、キャンセルボタンを押したときは "cancel" を設定する。|必須。隠しフィールド \(type=hidden\) とし表示しない|
|セッション情報|セッション情報を保持するフィールド|独立モードのときは、必須。隠しフィールド \(type=hidden\) とし表示しない|

## 仕組みとカスタマイズ

パスワード変更サーブレットの表示画面は HTML で作成することにより、フルにカスタマイズできます。 カスタマイズした HTML 内にパラメータや設定値に従った情報を onload 時の java スクリプトで埋め込みます。 HTML 内の対応する要素に以下の id を付与してください。 また、OK ボタンの POST 時のフォームデータのコントロール名 \(name属性\) には id と同じ名前を付与してください。

|項目|id|置き換え|
|---|---|----|
|システム名|systemName|システム設定オブジェクトのシステム名の値のテキストノードを追加|
|ロゴ|logo|システム設定オブジェクトでロゴファイル名に指定した URL を持つ src 属性を追加|
|メッセージ|normal / initialStatus / aboutToExpire, daysToExpire / expiredStatus|デフォルトのときは、 initialStatus、 aboutToExpire および expiredStatus に style.display=none を設定。ユーザオブジェクトの変更要求フラグが true のときは、 normal、 aboutToExpire および expiredStatus に style.display=none を設定。ユーザオブジェクトの有効期限の残り日数が、システム設定オブジェクトのPW変更促進メッセージ表示開始日で指定した日数以下になったときは、 normal、 initialStatus および expiredStatus に style.display=none を設定。また aboutToExpire のメッセージ内の daysToExpire に残り日数のテキストノードを追加。ユーザオブジェクトの有効期限が切れたときは、 normal、 initialStatus および aboutToExpire に style.display=none を設定|
|ユーザID|uid|呼び出しパラメータの uid の値を value に設定。連携モードのとき、または独立モードで呼び出しパラメータの uid で値が指定されているときは、 readonly 属性を追加|
|エラーメッセージ|errorMessage|エラーメッセージの <p\> 要素を子ノードに追加。エラーがないときは、 style.display=none を設定|
|現在のパスワード|password \(passwordTop\)|呼び出しパラメータのパスワード非要求フラグが指定されている場合は、style.display=none を設定。passwordTop は password の上位要素（フォームのコントロールでない）として使用することができ、呼び出しパラメータのパスワード非要求フラグが指定されている場合は、 style.display=none を設定。なくてもよい|
|新しいパスワード|newPassword| |
|新しいパスワード（確認用）|newPasswordC| |
|パスワードポリシー|policy|パスワードポリシーを説明する複数の <div\> 要素を子ノードに追加|
|秘密の質問|question \(questionTop\)|システム設定オブジェクトの PW秘密質問利用が false の場合は style.display=none を設定。 また、呼び出しパラメータの秘密の質問設定表示に display が指定されている場合は、ユーザオブジェクトの question の値を value に設定。questionTop は question の上位要素（フォームのコントロールでない）として使用することができ、呼び出しパラメータのパスワード非要求フラグが指定されている場合は、 style.display=none を設定。なくてもよい|
|答え|answer \(answerTop\)|システム設定オブジェクトの PW秘密質問利用が false の場合は style.display=none を設定。 また、呼び出しパラメータの秘密の質問設定表示に display が指定されている場合は、ユーザオブジェクトの answer の値を value に設定。answerTop は answer の上位要素（フォームのコントロールでない）として使用することができ、呼び出しパラメータのパスワード非要求フラグが指定されている場合は、 style.display=none を設定。なくてもよい|
|秘密の質問の説明文|questionDescription|システム設定オブジェクトの PW秘密質問利用が false、または、呼び出しパラメータの秘密の質問設定表示に none が指定されている場合は style.display=none を設定|
|OKボタン|ok| |
|キャンセルボタン|cancel|呼び出しパラメータの要求時のみフラグが指定されている場合は、 style.display=none を設定|
|実行種別|btnName| |
|セッション情報|sessionInfo|セッション情報を value に設定|

パスワード変更サーブレットとカスタマイズした HTML を連携させるために HTML ファイルには、以下の設定が必要です。

-   script タグで /changePassword/setParameter.js を読み込む
-   body タグの onload で呼ばれる関数の中で replaceElements\(\) 関数を呼び出す （body タグ配下のトップレベルの要素に style.display=none を指定しておき、replaceElements\(\) 呼び出し後に、 style.display=block に変更することで、画面の切り替わり内容がエンドユーザに 見えてしまうのを防ぐことができます）
-   フォームの POST 先は /changePassword/doChangePassword、フォーム名は changePasswordForm とする
-   scriptで、バリデート用の関数を呼び出すことで、入力値のチェックを行うことができる。バリデート用の関数については、後述

カスタマイズ可能なファイルは以下のとおりです。

|項目|格納場所 \(/opt/tomcat7/webapps/changePassword 配下\)|説明|
|---|-----------------------------------------------|---|
|パスワード変更画面|html/UpdatePassword.html|パスワード変更サーブレットの表示画面。この HTML はフルにカスタマイズできる。カスタマイズについては、上記「仕組みとカスタマイズ」を参照|
|スタイルシート|css/changePassword.css 他|パスワード変更サーブレットの表示画面で使用しているスタイルシートファイル。カスタマイズした HTML でインクルードしたオリジナルの css を同フォルダに配置することも可能|
|スクリプトファイル|script/changePassword.js|HTML で実行される関数を含むスクリプトファイル。カスタマイズした HTML でインクルードしたオリジナルの js を同フォルダに配置することも可能|
|メッセージファイル|script/message.json|画面に表示されるメッセージ文。属性の表示名を変更したい場合などにカスタマイズする。ファイルは json 形式で、value 値以外は変更不可。また、value 値の中の <span id='id名'\>\{数値\}</span\> の変更も不可|
|パスワードポリシー説明文ファイル|script/passwordPolicyMessages.json|id が pwd\_policy\_customize\_message の value 値にオリジナルのパスワードポリシー説明文を追加できる。ファイルは json 形式で、id が pwd\_policy\_customize\_message の value 値以外は変更不可。追加例は表外ヒントを参照。 当ファイルに説明文を追加するのでなく、HTML ファイルに直接オリジナルのパスワードポリシー説明文を書くことも可能|

**Tip:** \{"id":"pwd\_policy\_customize\_message", "value":""\} → \{"id":"pwd\_policy\_customize\_message", "value":"・半角数字、半角大文字英字、半角小文字英字がそれぞれ１文字以上混在していること"\}

以下に HTML の例を示します。

```

<?xml version="1.0" encoding="UTF-8" ?>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <title>NetSoarer ID Manager パスワード変更</title>
  <script src="/changePassword/setParameter.js" type="text/javascript"></script>
  <script type="text/javascript">
  <!--
  function setInitialData() {
    replaceElements();
    document.getElementById('all').style.display = 'block';
    return;
  }
  function cancelChangePassword() {
    document.getElementById("btnName").value = "cancel";
    document.changePasswordForm.submit();
  }
  function doChangePassword() {
    document.getElementById("btnName").value = "ok";
    document.changePasswordForm.submit();
  }
  //-->
  </script>
</head>
<body id="all" style="display:none" onload="setInitialData();">
  <img id="logo" border="0" alt="ロゴ"/>
  <p id="systemName"/>
  
  <div class="outBlock">
    <p id="normal">パスワードを変更してください。</p>
    <p id="initialStatus">現在のパスワードは初期パスワードです。パスワードを変更してください。</p>
    <p id="aboutToExpire">現在のパスワードの有効期限があと<span id="daysToExpire"></span>日で切れます。パスワードを変更してください。</p>      
    <p id="expiredStatus">パスワードの有効期限が切れています。パスワードを変更してください。</p>      
    <div id="errorMessage"></div>
    
    <form method="post" action="/changePassword/doChangePassword" name="changePasswordForm">
      <input type="hidden" name="btnName" id="btnName" value=""/>
      <table>
        <tr>
          <th>ユーザID：</th>
          <td><input type="text" name="uid" id="uid" value=""/></td>
        </tr>
        <tr id="passwordTop">
          <th>現在のパスワード：</th>
          <td><input type="password" name="password" id="password"/></td>
        </tr>
        <tr>
          <th>新しいパスワード：</th>
          <td><input type="password" name="newPassword" id="newPassword"/></td>
        </tr>
        <tr>
          <th>新しいパスワード（確認用）：</th>
          <td><input type="password" name="newPasswordC" id="newPasswordC"/></td>
        </tr>
        <tr id="questionTop">
          <th>秘密の質問：</th>
          <td><input type="text" name="question" id="question" value=""/></td>
        </tr>
        <tr id="answerTop">
          <th>答え：</th>
          <td><input type="text" name="answer" id="answer" value=""/></td>
        </tr>
      </table>
      <center>
        <input type="button" id="ok" value="OK" onclick="doChangePassword();"/>
        <input type="button" id="cancel" value="キャンセル" onclick="cancelChangePassword();"/>
      </center>
    </form>
    
    <div id="policy"></div>
    <div id="questionDescription"></div>
  </div>
</body>
</html>
   
```

## 終了ステータス

パスワード変更サーブレットの呼び出しパラメータ「戻り先URL」にリダイレクトするとき、クエリ文字列 status が付加されます。 戻り先では、 status の値によって動作を切り分けることができます。

|status|付加条件|
|------|----|
|success|パスワード変更が正常に終了したとき。呼び出しパラメータの要求時のみフラグが true で、パスワード変更の必要がなかったとき|
|cancel|キャンセルボタンを押したとき。独立モードで呼び出しパラメータのユーザに指定したユーザが存在しなかったとき。更新競合のため、パスワード変更ができなかったとき|

## JavaScriptバリデート関数

カスタマイズした HTML の script から JavaScriptバリデート関数を呼び出すことで、入力値のエラーチェックを行うことができます。標準でサポートされている関数は次のとおりです。

|関数名|パラメータ|戻り値|チェック概要|
|---|-----|---|------|
|checkUid|なし|エラーID \(id\) とエラーメッセージ \(message\) を持つオブジェクトの配列。配列名.length == 0のとき、エラーなし|ユーザID のチェック。必須項目チェック。readonly のときは、チェックしない|
|checkPassword|なし|同上|現在のパスワードのチェック。必須項目チェック。呼び出しパラメータのパスワード非要求フラグが true のときは、チェックしない|
|checkNewPassword|なし|同上|新しいパスワードのチェック。必須項目チェック。パスワードポリシーに合っているかチェック|
|checkNewPasswordC|なし|同上|新しいパスワード（確認用）のチェック。必須項目チェック。パスワードポリシーに合っているかチェック|
|checkNewPasswordCShort|なし|同上|新しいパスワード（確認用）のチェック。新しいパスワード、新しいパスワード（確認用）の一致チェック。新しいパスワードが入っていて、新しいパスワード（確認用）が入っていないときのみチェック。checkNewPasswordC または checkNewPasswordCShort のどちらかを使用すればよい|
|checkQuestion|なし|同上|秘密の質問のチェック。必須項目チェック。システム設定オブジェクトの PW秘密質問利用が true の場合で、呼び出しパラメータの秘密の質問設定表示が display のとき、または、秘密の質問設定表示が noValue で秘密の質問必須フラグが true のときのみチェック|
|checkAnswer|なし|同上|答えのチェック。必須項目チェック。システム設定オブジェクトの PW秘密質問利用が true の場合で、呼び出しパラメータの秘密の質問設定表示が display のとき、または、秘密の質問設定表示が noValue で秘密の質問必須フラグが true のときのみチェック|
|checkAccordNewPassword|なし|同上|新しいパスワード、新しいパスワード（確認用）の一致チェック|
|checkSamePassword|なし|同上|呼び出しパラメータのパスワード非要求フラグが false で、システム設定オブジェクトの PW同一パスワード許可が false の場合、現在のパスワードと新しいパスワードが同一値かのチェック|

## エラーメッセージ

ここでは、パスワード変更サーブレットのエラーメッセージを示します。表中の斜体の部分はメッセージに具体的な情報が含まれることを示します。

|メッセージ|補足説明|
|-----|----|
|*\(パラメータ名\)*パラメータに指定されたシステムIDが存在しません。（指定された値：*\(指定された値\)*）| |
|*\(パラメータ名\)*パラメータは必須です。| |
|*\(パラメータ名\)*パラメータは、連携モードのとき必須です。| |
|*\(パラメータ名\)*パラメータは、独立モードのとき指定できません。| |
|*\(パラメータ名\)*パラメータに指定できない値が指定されました。trueまたはfalseを指定してください。\(指定された値：*\(指定された値\)*\)| |
|*\(パラメータ名\)*パラメータに指定できない値が指定されました。連携モードでは*\(指定可能な値\)*が指定できます。\(指定された値：*\(指定された値\)*\)| |
|*\(パラメータ名\)*パラメータに指定できない値が指定されました。独立モードでは*\(指定可能な値\)*が指定できます。\(指定された値：*\(指定された値\)*\)| |
|*\(パラメータ名\)*パラメータに既定値*\(該当パラメータの既定値\)*を設定して処理を続行しました。| |
|システム設定オブジェクトの「PW変更インタフェース」が設定されていません。| |
|*\(パラメータ名\)*パラメータの形式が誤っています。「*\(正しい日付形式\)*」形式で指定してください。| |
|不正な呼び出しが行われました。*\(パラメータ名\)*パラメータの呼び出し時刻と、受信時の時刻に前後５分以上の開きがあります。\(呼び出し時刻：*\(呼び出し時刻\)*, 受信時刻：*\(受信時刻\)*\)| |
|*\(パラメータ名\)*パラメータに指定できない値が指定されました。*\(関連するパラメータ名\)*パラメータが*\(関連するパラメータの値\)*のときは、*\(指定可能な値\)*を指定してください。\(指定された値：*\(指定された値\)*\)| |
|パスワード変更サーブレットの他の呼び出しパラメータにエラーがあるため、*\(パラメータ名\)*パラメータのチェックができませんでした。| |
|連携システムの署名の確認に失敗しました。呼び出しパラメータの過不足や指定順序の誤り、*\(パラメータ名\)*パラメータに指定されたシステムIDの誤り、*\(パラメータ名\)*パラメータ値の生成結果が誤っている、連携システムと共有している秘密のパスワードが異なっている、または不正アクセスの可能性があります。| |
|パスワード変更サーブレットの呼び出し\(GET\)中にエラーが発生しました。エラー：*\(詳細エラー\)*。URLのクエリ文字列：*\(実行されたクエリ文字列\)*| |
|パスワード変更サーブレットの呼び出しパラメータにエラーがあります。| |
|パスワード変更サーブレットの呼び出し\(POST\)中にエラーが発生しました。（詳細：*\(詳細エラー\)*）| |
|セッション情報がないため、パスワード変更画面が正しく表示できませんでした。タイムアウトした可能性があります。| |
|セッション情報にパスワード変更サーブレットの呼び出しパラメータ情報がないため、パスワード変更画面が正しく表示できませんでした。タイムアウトした可能性があります。| |
|動的スクリプト作成処理中にエラーが発生したため、パスワード変更画面が正しく表示できませんでした。（詳細：*\(詳細エラー\)*）| |
|有効期限の形式が異なるため、有効期限までの日数処理ができませんでした。「*\(正しい日付形式\)*」形式で指定してください。| |
|セッション情報がないため、パスワード変更処理ができませんでした。セッションタイムアウト、または予期しないボタンからパスワード変更処理が実行された可能性があります。| |
|セッション情報に呼び出しパラメータ情報がないため、パスワード変更処理ができませんでした。予期しないボタンからパスワード変更処理が実行された可能性があります。| |
|パスワード変更サーブレットの呼び出し\(POST\)中にエラーが発生しました。（エラー：*\(詳細エラー\)*）| |
|予期しないボタンからパスワード変更処理が実行されました。（実行された値：*\(実行された値\)*）| |
|ユーザIDまたはパスワードが誤っています。\(ユーザID:*\(ユーザID\)*\)| |
|*\(オブジェクト名\)*の参照でエラーが返却されました。（詳細：*\(詳細エラー\)*）| |
|パスワード変更サーブレットの*\(パラメータ名\)*パラメータに指定されたユーザIDが存在しません。（指定された値：*\(指定された値\)*）| |
|パスワード変更サーブレットの*\(パラメータ名\)*パラメータに指定されたユーザIDが存在しません。（指定された値：*\(指定された値\)*）| |
|更新処理で編集競合が発生したため、パスワード変更できませんでした。（詳細：*\(詳細エラー\)*）| |
|パスワード変更サーブレットjsonエラーメッセージ（言語：*\(実行言語\)*）は登録されていません。| |
|パスワード変更サーブレットjsonエラーメッセージ（*\(メッセージid\)*）は登録されていません。| |
|パスワード変更サーブレットjsonエラーメッセージの埋め込み文字が不足しています。（id:*\(メッセージid\)*）| |
|パスワード変更サーブレットjsonエラーメッセージの埋め込み文字が設定されていません。（id:*\(メッセージid\)*）| |
|パスワードポリシー（言語：*\(実行言語\)*）は登録されていません。| |
|パスワードポリシーは登録されていません。（id:*\(メッセージid\)*）| |
|パスワードポリシーの埋め込み文字が不足しています。（id:*\(メッセージid\)*）| |
|パスワードポリシーの埋め込み文字が設定されていません。（id:*\(メッセージid\)*）| |
|ファイルを再読み込みしました\(PATH=*\(ファイルのパス名\)*\)| |
|パスワード変更サーブレットのエラーメッセージ（言語：*\(実行言語\)*）は登録されていません。| |
|パスワード変更サーブレットのエラーコード（*\(エラーid\)*）は登録されていません。| |
|パスワード変更サーブレットのエラー処理中に例外が発生しました（詳細：*\(詳細エラー\)*）| |
|テナントID（*テナントID*）に対する設定ファイルが取得できませんでした。|マルチテナント機能を使って実行されたが、テナントID に対する設定ファイルが見つからなかったため、システム設定オブジェクトの値で処理が続行された。|

|エラー番号|メッセージ|補足説明|
|-----|-----|----|
|7924|エラーが発生したため、パスワードの変更ができません。後日もう一度お試しください。\(7924\)|更新処理で他のユーザと編集競合が発生したため、利用者によるパスワード変更できなかった。IDM2ログのコード7924で競合属性の確認が可能。|
|7801|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7801\)|/changePassword/setParameter.jsの読み込みに失敗した。HTML ファイルに script タグで /changePassword/setParameter.js を指定していない、または、サーブレット側でエラーが発生している可能性がある。|
|7802|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7802\)|キャンセルボタンの実行に失敗した。HTML ファイルに実行種別 \(btnName\) が指定されていない。|
|7803|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7803\)|OKボタンの実行に失敗した。HTML ファイルに実行種別 \(btnName\) が指定されていない。|
|7804|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7804\)|エラーメッセージの表示に失敗した。HTML ファイルにエラーメッセージ \(errorMessage\) が指定されていない。|
|7805|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7805:*id名*\)|必須項目チェックを行ったが、HTML ファイルに対象となる id 名が指定されていない。|
|7806|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7806\)|独立モードでシステム設定オブジェクトの PW秘密質問利用のとき、秘密の質問設定表示 \(questionField\) に display を指定できない。|
|7807|NotFound message\(7807:*メッセージid*, *使用言語*\)|メッセージファイル message.json に該当するメッセージが登録されていない。|
|7808|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7808:*メッセージid*\)|メッセージファイル message.json に該当するメッセージの埋め込み情報が不足している。|
|7809|システムが一時的に使用できないか、障害が発生している可能性があります。あとでもう一度お試しください。\(7809:*メッセージid*\)|メッセージファイル message.json に該当するメッセージに埋め込み情報が設定されていない。|

## サポート対象ブラウザ

パスワード変更サーブレットの対象ブラウザは以下のとおりです（バージョンについては、リリースメモを参照してください）。

-   Windows IE9
-   Windows IE10 （未実行）
-   Windows FireFox
-   Windows Chrome
-   Mac OS Safari
-   Mac OS FireFox
-   Mac OS Chrome
