---
author: Procube Co.,Ltd.
---

# 暗号化設定

属性の暗号化設定を設定することで、データベースに保存される値を暗号化したり、ハッシュしたりすることができます。

## 概要

属性定義の暗号化設定には、SSHA か AES を指定することができます。 SSHA を指定した場合、ソルト付きの SHA1 アルゴリズムでハッシュされた値がデータベースに格納され、 AES を指定した場合、256ビット AES アルゴリズムで暗号化された値がデータベースに格納されます。

ハッシュや暗号化されたデータは、IDM2 内部で復号化されることはありません。 ただし、AES で暗号化されたデータは、プロビジョニング時に必要に応じて、復号化が行われます。

## パスワードを暗号化する場合の注意

パスワードを暗号化する場合、一度保存するともとの値を IDM2 の画面から参照することはできません。 新規ユーザの一括登録や、パスワードリセットの際に、エンドユーザにパスワードが通知できるように設計をしてください。 初期パスワード等を平文で残したい場合は、初期パスワードの属性を別途用意し、 インタフェース定義の初期化式やガジェット定義のコマンド動作で値を暗号化設定された属性に複製してください。

## インタフェース上での暗号化

属性定義の暗号化設定が指定されている属性にデータを書き込む際、 入力データが平文であると判断されると自動的に暗号化が行われます。 この暗号化はインタフェース定義の初期化式、属性定義の文字列制限のチェック、 マスターデータベースへのプロビジョニング時の導出式の評価の後に実行されます。 平文データであると判断される条件は以下の通りです。

-   先頭が「\{CLEARTEXT\}」で始まっている場合、後続するデータのすべてが暗号化対象データであるとみなされる
-   先頭文字が「\{」以外の文字である場合、データ全体が暗号化対象データであるとみなされる

先頭文字が「\{」である場合は、「\{CLEARTEXT\}」「\{SSHA\}」「\{AES\}」のいずれかでなければならず、 他の文字列が続く場合はエラーとなります。また、「\{SSHA\}」「\{AES\}」が指定された場合は、以下のルールとなります。

-   「\{SSHA\}」「\{AES\}」の指定が属性の暗号化設定と一致している場合は、そのまま保存される
-   「\{SSHA\}」で始まるデータを暗号化設定として AES が指定された属性に書き込もうとした場合は、エラーになる
-   「\{AES\}」で始まるデータを暗号化設定として SSHA が指定された属性に書き込もうとした場合は、データを復号化し、SSHAでハッシュした値が保存される

ハッシュされた場合および暗号化された場合のデータの保存形式は、 それぞれ、[SHA1 ハッシュ](hash)および[AES 暗号化](crypt) を参照してください。

## AES 暗号の復号化データの取得

AES 暗号化設定された属性は、参照等の REST API レスポンスでも暗号化された形式で返されます。 システム連携で復号化した値を参照する必要がある場合、AES復号化レスポンス使用フラグを指定したインタフェースを使用することで、復号化後の値（平文）を取得できます。

## プロビジョニング時の AES 暗号の復号化

AES で暗号化されたデータは、プロビジョニング時に復号化されます。 システム連携で暗号化したままデータを渡したい場合は、クラスプロビジョニング設定の非復号化フラグを指定してください。

## AES 暗号の SHA1 ハッシュ値への変換

「インタフェース上での暗号化」で述べた通り、AES で暗号化されて文字列化されたデータ、すなわち、 「\{AES\}」で始まる文字列を暗号化設定に SSHA が指定されている属性に書き込むことで、 SSHA ハッシュ値に変換することができます。このことを利用して、パスワードの値を AES で暗号化して保存しておき、 暗号化設定 SSHA を指定した別の属性に導出式で転記することにより、ハッシュ値に変換することが可能です。 OpenLDAP など SSHA のハッシュ値を必要とするシステムにはこの変換後のハッシュ値を渡すことによって、 平文パスワードのプロビジョニングを回避することが可能です。
