---
author: Procube Co.,Ltd.
---

# インポート設定

インポート設定はインポートの設定を保持します。 BindBroker はクロックデーモンを契機として、インポート処理を起動し、データの取り込み処理を実行します。

## 処理概要

## データ型

インポート設定の属性は以下の通りです。

|名前 / 表示名|説明|データ型|修飾子|
|--------|---|----|---|
|name / 名前|インポート設定の名前|string|必須、システムID、一意|
|displayName / 表示名|インポート設定の表示名|string| |
|description / 説明文|インポート設定の説明 - ヘルプの生成に使用される|string| |
|classSettings / クラスインポート設定|[クラスインポート設定](classImportSetting)のリスト|object\[\]|クラスインポート設定オブジェクト|
|dataType / データ種別|インポート元のデータ種別。 IDM2 では、以下の種類のインポートを提供する。**CSVDownload**: CSVファイルをダウンロードし、インポート処理を実行する。**RDB**: リレーショナルデータベースを参照しインポート処理を実行する。|string|必須、\[CSVDownload, RDB\] のいずれか|
|fileType / CSVファイル形式|CSVファイルのインポートの場合に読み込むファイル形式|string|\[CSV, TSV\] のいずれか、データ種別が CSVDownload のときのみ有効|
|downloadAll / 全件フラグ|このフラグが true の場合は、インポート元データが全件であることを表す。 -   BindBroker は全件ダウンロード後、クラスのキープロパティの値を比較し、編集用データベースに存在するものについては変更し、存在しないものについては追加し、編集用データベースのみに存在するものを削除する。、このフラグが false の場合は、差分インポート処理を行う。差分インポート処理では、差分種別列の値に従って追加・変更・削除を行う|boolean| |
|commentHeader / コメント行数|CSVファイルのインポートの場合にコメント行として先頭行から読み飛ばす行数。属性名のヘッダ行がある場合はコメント行の後にあるものとして対応する。|number|データ種別が CSVDownload のときのみ有効|
|withHeader / ヘッダ行フラグ|CSVファイルのインポートの場合に先頭行がヘッダ行であるかいなかを表す -   true の場合、ヘッダ行であることを表す、ヘッダ行がある場合、その各列は属性名を保持し、インタフェースで必要とする属性をすべて含んでいなければならない、ヘッダ行がない場合は、インタフェースで指定された順序で属性を保持しているとみなされる、差分インポート（全件フラグが false）でヘッダ行がない場合、先頭列は差分種別を保持していると見なされる|boolean|必須、データ種別が CSVDownload のときのみ有効|
|seqFieldName / 連番列名|データベースを参照する差分インポート処理において処理順序を表す連番が入っている列の名前 -   連番列自身はインポートの対象とならない、データベースを Query する際に連番列に対する order by 句を指定して、連番順に処理を実行する、列名が指定されていない場合は、連番はないものと見なされる、BindBroker は最終番号テーブルに処理したレコードの連番を記録し、次回インポート処理時に次の連番以降に絞り込んで問い合わせる|string|必須、データ種別が RDB のときのみ有効|
|importTimestampFieldName / インポート日時記録列名|データベースを参照する差分インポート処理においてインポート実行処理日時を記録する列の名前|string|データ種別が RDB のときのみ有効|
|opFieldName / 差分種別列名|差分インポート処理における差分種別が入っている列の名前 -   差分処理列自身はインポートの対象とならない、CSVダウンロードの場合で、先頭行が列名でない場合は、先頭列が差分種別列となる|string|必須、全件フラグが false のときのみ有効|
|addOp / 追加命令|差分インポート処理において、追加を指示する差分種別列の値|string|必須、全件フラグが false のときのみ有効|
|deleteOp / 変更命令|差分インポート処理において、変更を指示する差分種別列の値|string|必須、全件フラグが false のときのみ有効|
|deleteOp / 削除命令|差分インポート処理において、削除を指示する差分種別列の値|string|必須、全件フラグが false のときのみ有効|
|limit / 上限件数|一度のインポート処理で処理する上限件数\(RDBのみ\)|number|データ種別が RDB のときのみ有効|
|encode / CSVエンコード|データ種別が CSVDownload であるときに CSV ファイルの文字コード|string|必須、データ種別が CSVDownload のときのみ有効、\[UTF-8, Shift-JIS, CP932\] のいづれか|
|dateFormat / 日付フォーマット|文字列型のフィールドを読み込んで、日時型、日付型に変換する際に日付の区切り記号に使用できる文字を限定する。**both**: '-' か '/'。**slashOnly**: '/' のみ。**hyphenOnly**: '-' のみ  |string|\[both, slashOnly, hyphenOnly\] のいずれか|
|complementDateTimeString / 日時桁補完|文字列型のフィールドを読み込んで、日時型、日付型に変換する際に年の桁数を補完する。３桁の場合は先頭に2を追加し、２桁の場合はシステム日付が2049年までは '50～99年は1950～1999年に変換され、それ以外は20を追加する。|boolean| |
|host / ホスト名|インポート元のホスト名|string|必須、データ種別が RDB またはダウンローダが ftp, custom のときのみ有効|
|port / ポート番号|インポート元のサーバのポート番号 -   省略時、データ種別が RDB の場合はPostgreSQLの5432|number|データ種別が RDB またはダウンローダが ftp, custom のときのみ有効|
|downloader / ダウンローダ|CSV ファイルをインポートする場合の CSVファイルのダウンローダ。**ftp**: ftp でダウンロードします。**local**: ID Manager のサーバ内のディレクトリからインポートします。**custom**: カスタムダウンローダでダウンロードします。|string|必須、データ種別が CSVDownload のときのみ有効、\[ftp, scp, local, custom\] のいずれか|
|downloaderPath / ダウンローダパス|ダウンローダに custom が指定された場合のカスタムダウンローダのコマンドのパス（インタフェースについては「カスタムダウンローダのインタフェース」の節を参照）|string|必須、ダウンローダが custom のときのみ有効|
|loginname / ID|インポート元にログインする際のユーザID|string|必須、データ種別が RDB またはダウンローダが ftp, custom のときのみ有効|
|password / パスワード|インポート元ホストにログインする際のパスワード|string|データ種別が RDB またはダウンローダが ftp, custom のときのみ有効|
|database / データベース|インポート元でデータが入っている場所を示す。 -   データ種別が RDB であるときは、データベース名を表す、データ種別が CSVDownload であるときは CSVファイルが置いてあるディレクトリを指す|string|必須|
|ignoreError / エラー行を無視して処理を続行|インポートデータにエラーがあった場合も一時停止せずに後続のインポート処理を続行する。|boolean| |
|stopFlag / 一時停止フラグ|このインポート設定によるインポートを一時的に停止するか否かを示すフラグ。インポート時にエラーがあった場合に続行設定がなければ、このフラグを設定して自動的に一時停止される。|boolean| |

## CSVファイルのインポートルール

インポート設定のデータ種別が CSVDownload であるときは、全件フラグが true の場合と false の場合で動作が異なります。

全件フラグが true の場合、クラスインポート設定の「テーブル名」は以下のように扱われます。
、テーブル名はCSVファイルのファイル名を表し、インポート設定の「データベース名」に設定されているディレクトリパスの配下から指定されたファイルをダウンロードする、テーブル名内に %YYYY%、 %MM%、 %DD% が出現すると、それぞれ処理実行時の年、月、日に置換される

全件フラグが false の場合、クラスインポート設定の「テーブル名」は以下のように扱われます。
、テーブル名はCSVファイルが置かれているサブディレクトリ名を表し、インポート設定の「データベース名」 に設定されているディレクトリパスの配下の指定されたサブディレクトリに存在するファイルをすべてダウンロードする、インポートに成功すると、ダウンロードしたファイルをインポート元ディレクトリから、削除する、「エラー行を無視して処理を続行」フラグに true が指定されている場合は、インポートに失敗した場合も、ダウンロードしたファイルをインポート元ディレクトリから、削除する

## カスタムダウンローダのインタフェース

カスタムダウンローダが指定されている場合は、インポータはカスタムダウンローダをコマンドとして起動し、 ダウンロードされた CSVファイルをインポートします。カスタムダウンローダは、ファイルのダウンロード時と削除時の両方で呼び出されます。

以下にインタフェースを以下に示します。
、引数は6つで、インポート設定とクラスインポート設定から「ホスト名」、「ポート番号」、「ID」、「パスワード」、「データベース」、「テーブル名」が渡される、引数は次のように指定される。「-h ホスト名 -p ポート番号 -u ID -w パスワード -b データベース -n テーブル名」、インポータはダウンロード用の一時ディレクトリを毎回作成し、そこを作業ディレクトリとしてカスタムダウンローダを呼び出す、カスタムダウンローダは、ダウンロード時はコマンドの標準出力にダウンロードしたファイル名を1行に1個ずつ出力する、インポータは、インポート完了後も一時ディレクトリを削除しないが、ID Manager の月次バッチにより3ヶ月後の月初に削除される、カスタムダウンローダは、ダウンロードしたファイルをすべて作業ディレクトリにダウンロード元と同じファイル名で置く、全件フラグが false の場合、インポータは 1個ファイルを読み込むごとに、そのファイルを削除するためにカスタムダウンローダを呼び出す、削除時はダウンロード時の引数に上記に加えて、オプション -d と削除対象のファイル名が渡される、オプション -d が渡された場合、カスタムダウンローダはファイルの削除のみを行い、ダウンロードは行わない、処理経過やエラーメッセージは標準エラー出力に出力する（改行を含んでいても良い）、標準エラー出力の最後の行は、\[FAILED\] あるいは \[SUCCESS\] のいずれかでなければならない、標準エラー出力に出力の最後の行以外の内容は idm2log に出力される

## REST API パス

このオブジェクトにアクセスする場合の REST API のパスは以下の通りです。

|種別|パス|
|---|---|
|クラスの定義のパス|"/IDManager/\_classes/\_importSetting"|
|インスタンスのパス|"/IDManager/\_sandboxImportSettings/" + this.name|
