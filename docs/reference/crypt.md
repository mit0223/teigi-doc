---
author: Procube Co.,Ltd.
---

# AES暗号化

IDM2 では、パスワード等の情報を AES アルゴリズムで暗号化して格納することができます。

## 概要

IDM2 の AES 暗号化では、以下の暗号化パラメータを使用しています。

-   暗号化鍵の交換を簡単にするためにPBE\(Password Based Encryption\)を使用し、鍵のかわりに暗号化用パスワードを共有する
-   暗号化のアルゴリズムは AES 256とする
-   ブロック暗号化モードを CBC とする

## データの形式

IDM2 の AES 暗号化では、 Linux の OpenSSL の enc コマンドと互換性のある形式を用いて暗号化し、 base64エンコードした上で、先頭に "\{AES\}" という固定した５文字を追加して格納します。 OpenSSL の enc コマンドは先頭に "Salted\_\_" というマジック文字列の後、8バイトのSalt値を保持し、その後、その Salt 値とパスフレーズをハッシュして生成された32バイトの鍵と iv（初期化ベクタ）で暗号化されたデータを保持しています。 暗号のブロックサイズは16バイトです。

パスフレーズはシステム設定オブジェクトのパスフレーズ属性に保持しているものを使用します。

## システム連携時の互換性の確認方法

IDM2 に暗号化したデータを送る場合、以下の方法で復号化することでその互換性を確認できます。

```
openssl enc -aes-256-cbc -in 暗号化データ -out 平文データ -pass pass:"Secret Passphrase" -d -a
```

ただし、このコマンドで確認されたデータ（上記「暗号化データ」で指定されたファイルの中身）の先頭に "\{AES\}" の5文字を追加して送っていただく必要があります。ここで、"Secret Passphrase" は暗号化するシステムと IDM2 の間で事前に共有されたパスフレーズです。

IDM2 から暗号化したデータを受け取る場合、以下の方法で暗号化したデータでテストすることでその互換性を確認できます。

```
openssl enc -aes-256-cbc -in 平文データ -out 暗号化データ -pass pass:"Secret Passphrase" -e -base64
```

ただし、このコマンドで確認されたデータ（上記「暗号化データ」で指定されたファイルの中身）の先頭に "\{AES\}" の5文字を追加してテストしていただく必要があります。
